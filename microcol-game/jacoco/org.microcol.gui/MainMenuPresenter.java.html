<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MainMenuPresenter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MicroCol game classes</a> &gt; <a href="index.source.html" class="el_package">org.microcol.gui</a> &gt; <span class="el_source">MainMenuPresenter.java</span></div><h1>MainMenuPresenter.java</h1><pre class="source lang-java linenums">package org.microcol.gui;

import javax.swing.JCheckBoxMenuItem;
import javax.swing.JMenuItem;
import javax.swing.JRadioButtonMenuItem;

import org.microcol.gui.event.AboutGameEvent;
import org.microcol.gui.event.AboutGameEventController;
import org.microcol.gui.event.CenterViewController;
import org.microcol.gui.event.CenterViewEvent;
import org.microcol.gui.event.ChangeLanguageController;
import org.microcol.gui.event.ChangeLanguageEvent;
import org.microcol.gui.event.ExitGameController;
import org.microcol.gui.event.ExitGameEvent;
import org.microcol.gui.event.FocusedTileController;
import org.microcol.gui.event.FocusedTileEvent;
import org.microcol.gui.event.GameController;
import org.microcol.gui.event.MoveUnitController;
import org.microcol.gui.event.ShowGridController;
import org.microcol.gui.event.ShowGridEvent;
import org.microcol.gui.event.TurnStartedController;
import org.microcol.gui.event.VolumeChangeController;
import org.microcol.model.event.TurnStartedEvent;

import com.google.common.base.Preconditions;
import com.google.inject.Inject;

public class MainMenuPresenter {

	public interface Display {
		JMenuItem getMenuItemNewGame();

		JMenuItem getMenuItemLoadGame();

		JMenuItem getMenuItemSameGame();

		JMenuItem getMenuItemQuitGame();

		JMenuItem getMenuItemAbout();

		JRadioButtonMenuItem getRbMenuItemlanguageEn();

		JRadioButtonMenuItem getRbMenuItemlanguageCz();

		void updateLanguage();

		JMenuItem getMenuItemVolume();

		JCheckBoxMenuItem getMenuItemShowGrid();

		JMenuItem getMenuItemMove();

		JMenuItem getMenuItemCenterView();
	}

	private final MainMenuPresenter.Display display;

<span class="nc" id="L58">	private boolean isFocusedMoveableUnit = false;</span>

<span class="nc" id="L60">	public boolean isTileFocused = false;</span>

	@Inject
	public MainMenuPresenter(final MainMenuPresenter.Display display,
			final AboutGameEventController gameEventController, final GamePreferences gamePreferences,
			final ChangeLanguageController changeLanguangeController, final Text text, final ViewUtil viewUtil,
			final VolumeChangeController volumeChangeController, final ShowGridController showGridController,
			final FocusedTileController focusedTileController, final MoveUnitController moveUnitController,
			final CenterViewController centerViewController, final TurnStartedController turnStartedController,
<span class="nc" id="L69">			final ExitGameController exitGameController, final GameController gameController) {</span>
<span class="nc" id="L70">		this.display = Preconditions.checkNotNull(display);</span>
<span class="nc" id="L71">		display.getMenuItemNewGame().addActionListener(actionEvent -&gt; {</span>

<span class="nc" id="L73">		});</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">		if (!gamePreferences.isOSX()) {</span>
<span class="nc" id="L75">			display.getMenuItemQuitGame().addActionListener(actionEvent -&gt; {</span>
<span class="nc" id="L76">				exitGameController.fireEvent(new ExitGameEvent());</span>
<span class="nc" id="L77">			});</span>
<span class="nc" id="L78">			display.getMenuItemAbout().addActionListener(actionEvent -&gt; {</span>
<span class="nc" id="L79">				gameEventController.fireEvent(new AboutGameEvent());</span>
<span class="nc" id="L80">			});</span>
		}
<span class="nc" id="L82">		display.getRbMenuItemlanguageCz().addActionListener(actionEvent -&gt; {</span>
<span class="nc" id="L83">			changeLanguangeController.fireEvent(new ChangeLanguageEvent(Text.Language.cz, gameController.getModel()));</span>
<span class="nc" id="L84">		});</span>
<span class="nc" id="L85">		display.getRbMenuItemlanguageEn().addActionListener(actionEvent -&gt; {</span>
<span class="nc" id="L86">			changeLanguangeController.fireEvent(new ChangeLanguageEvent(Text.Language.en, gameController.getModel()));</span>
<span class="nc" id="L87">		});</span>
<span class="nc" id="L88">		display.getMenuItemVolume().addActionListener(actionEvent -&gt; {</span>
<span class="nc" id="L89">			PreferencesVolume preferencesVolume = new PreferencesVolume(viewUtil, text, volumeChangeController,</span>
<span class="nc" id="L90">					gamePreferences.getVolume());</span>
<span class="nc" id="L91">			preferencesVolume.setVisible(true);</span>
<span class="nc" id="L92">		});</span>
<span class="nc" id="L93">		display.getMenuItemShowGrid().addActionListener(ectionEvent -&gt; showGridController</span>
<span class="nc" id="L94">				.fireEvent(new ShowGridEvent(display.getMenuItemShowGrid().isSelected())));</span>
<span class="nc" id="L95">		display.getMenuItemMove().addActionListener(ectionEvent -&gt; {</span>
<span class="nc" id="L96">			moveUnitController.fireStartMoveEvent();</span>
<span class="nc" id="L97">			display.getMenuItemMove().setEnabled(false);</span>
<span class="nc" id="L98">		});</span>
<span class="nc" id="L99">		display.getMenuItemCenterView().addActionListener(event -&gt; centerViewController.fireEvent(new CenterViewEvent()));</span>
<span class="nc" id="L100">		changeLanguangeController.addListener(event -&gt; {</span>
<span class="nc" id="L101">			display.updateLanguage();</span>
<span class="nc" id="L102">		});</span>
<span class="nc" id="L103">		focusedTileController.addListener(event -&gt; onFocusedTileEvent(event));</span>
<span class="nc" id="L104">		turnStartedController.addListener(event -&gt; onTurnStartedEvent(event));</span>
<span class="nc" id="L105">	}</span>

	/**
	 * Method process event when user put focus to some tile.
	 * 
	 * @param event
	 *            required event
	 */
	private final void onFocusedTileEvent(final FocusedTileEvent event) {
<span class="nc" id="L114">		display.getMenuItemCenterView().setEnabled(true);</span>
<span class="nc" id="L115">		isTileFocused = true;</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">		if (event.isTileContainsMovebleUnit()) {</span>
<span class="nc" id="L117">			display.getMenuItemMove().setEnabled(true);</span>
<span class="nc" id="L118">			isFocusedMoveableUnit = true;</span>
		} else {
<span class="nc" id="L120">			display.getMenuItemMove().setEnabled(false);</span>
<span class="nc" id="L121">			isFocusedMoveableUnit = false;</span>
		}
<span class="nc" id="L123">	}</span>

	private final void onTurnStartedEvent(final TurnStartedEvent event) {
<span class="nc bnc" id="L126" title="All 2 branches missed.">		if (event.getPlayer().isHuman()) {</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">			if (isTileFocused) {</span>
<span class="nc" id="L128">				display.getMenuItemCenterView().setEnabled(true);</span>
			}
<span class="nc bnc" id="L130" title="All 2 branches missed.">			if (isFocusedMoveableUnit) {</span>
<span class="nc" id="L131">				display.getMenuItemMove().setEnabled(true);</span>
			}
		} else {
<span class="nc" id="L134">			display.getMenuItemCenterView().setEnabled(false);</span>
<span class="nc" id="L135">			display.getMenuItemMove().setEnabled(false);</span>
		}
<span class="nc" id="L137">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>