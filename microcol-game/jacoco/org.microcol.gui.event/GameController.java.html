<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MicroCol game classes</a> &gt; <a href="index.source.html" class="el_package">org.microcol.gui.event</a> &gt; <span class="el_source">GameController.java</span></div><h1>GameController.java</h1><pre class="source lang-java linenums">package org.microcol.gui.event;

import java.util.List;

import org.microcol.ai.AIModelBuilder;
import org.microcol.ai.SkyNet;
import org.microcol.gui.GamePreferences;
import org.microcol.gui.Localized;
import org.microcol.gui.MusicController;
import org.microcol.model.Location;
import org.microcol.model.Model;
import org.microcol.model.ModelAdapter;
import org.microcol.model.ModelBuilder;
import org.microcol.model.Path;
import org.microcol.model.Ship;
import org.microcol.model.ShipType;
import org.microcol.model.event.DebugRequestedEvent;
import org.microcol.model.event.GameFinishedEvent;
import org.microcol.model.event.GameStartedEvent;
import org.microcol.model.event.RoundStartedEvent;
import org.microcol.model.event.ShipMovedEvent;
import org.microcol.model.event.TurnStartedEvent;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.google.common.base.Preconditions;
import com.google.inject.Inject;

/**
 * Exchange events between model and GUI.
 */
public class GameController implements Localized {

<span class="nc" id="L34">	private Logger logger = LoggerFactory.getLogger(GameController.class);</span>

	private final NextTurnController nextTurnController;

	private final MoveUnitController moveUnitController;

	private final NewGameController newGameController;

	private final TurnStartedController turnStartedController;

	private final MusicController musicController;

	private final GamePreferences gamePreferences;

	private final DebugRequestController debugRequestController;

	private final GameFinishedController gameFinishedController;

	private Model game;

	@Inject
	public GameController(final NextTurnController nextTurnController, final MoveUnitController moveUnitController,
			final NewGameController newGameController, final TurnStartedController turnStartedController,
			final MusicController musicController, final GamePreferences gamePreferences,
<span class="nc" id="L58">			final DebugRequestController debugRequestController, final GameFinishedController gameFinishedController) {</span>
<span class="nc" id="L59">		this.nextTurnController = Preconditions.checkNotNull(nextTurnController);</span>
<span class="nc" id="L60">		this.moveUnitController = Preconditions.checkNotNull(moveUnitController);</span>
<span class="nc" id="L61">		this.newGameController = Preconditions.checkNotNull(newGameController);</span>
<span class="nc" id="L62">		this.turnStartedController = Preconditions.checkNotNull(turnStartedController);</span>
<span class="nc" id="L63">		this.musicController = Preconditions.checkNotNull(musicController);</span>
<span class="nc" id="L64">		this.gamePreferences = Preconditions.checkNotNull(gamePreferences);</span>
<span class="nc" id="L65">		this.debugRequestController = Preconditions.checkNotNull(debugRequestController);</span>
<span class="nc" id="L66">		this.gameFinishedController = Preconditions.checkNotNull(gameFinishedController);</span>
<span class="nc" id="L67">	}</span>

	/**
	 * Start new game and register listener.
	 */
	public void newGame() {
<span class="nc bnc" id="L73" title="All 2 branches missed.">		if (game != null) {</span>
			// TODO JJ already running game should be stopped
		}
<span class="nc bnc" id="L76" title="All 4 branches missed.">		if (&quot;true&quot;.equals(System.getProperty(&quot;development&quot;)) &amp;&amp; &quot;JKA&quot;.equals(System.getProperty(&quot;developer&quot;))) {</span>
<span class="nc" id="L77">			game = AIModelBuilder.build();</span>
		} else {
<span class="nc" id="L79">			ModelBuilder builder = new ModelBuilder();</span>
<span class="nc" id="L80">			builder.setCalendar(1570, 1600)</span>
<span class="nc" id="L81">				.setMap(&quot;/maps/map-01.txt&quot;)</span>
<span class="nc" id="L82">				.addPlayer(&quot;Player1&quot;, false)</span>
<span class="nc" id="L83">					.addShip(&quot;Player1&quot;, ShipType.GALLEON, Location.of(4, 2))</span>
<span class="nc" id="L84">					.addShip(&quot;Player1&quot;, ShipType.FRIGATE, Location.of(3, 3))</span>
<span class="nc" id="L85">				.addPlayer(&quot;Player2&quot;, true)</span>
<span class="nc" id="L86">					.addShip(&quot;Player2&quot;, ShipType.GALLEON, Location.of(7, 7))</span>
<span class="nc" id="L87">					.addShip(&quot;Player2&quot;, ShipType.FRIGATE, Location.of(7, 9));</span>
<span class="nc" id="L88">			game = builder.build();</span>
		}
<span class="nc" id="L90">		game.addListener(new ModelAdapter() {</span>

			@Override
			public void turnStarted(final TurnStartedEvent event) {
<span class="nc" id="L94">				turnStartedController.fireEvent(event);</span>
<span class="nc" id="L95">			}</span>

			@Override
			public void shipMoved(final ShipMovedEvent event) {
<span class="nc" id="L99">				moveUnitController.fireUnitMovedEvent(event);</span>
<span class="nc" id="L100">			}</span>

			@Override
			public void roundStarted(final RoundStartedEvent event) {
<span class="nc" id="L104">				nextTurnController.fireEvent(event);</span>
<span class="nc" id="L105">			}</span>

			@Override
			public void gameStarted(final GameStartedEvent event) {
<span class="nc" id="L109">				game = event.getModel();</span>
<span class="nc" id="L110">				newGameController.fireEvent(event);</span>
<span class="nc" id="L111">			}</span>

			@Override
			public void gameFinished(final GameFinishedEvent event) {
<span class="nc" id="L115">				logger.debug(&quot;Game finished &quot; + event);</span>
<span class="nc" id="L116">				gameFinishedController.fireEvent(event);</span>
<span class="nc" id="L117">			}</span>

			@Override
			public void debugRequested(final DebugRequestedEvent event) {
<span class="nc" id="L121">				debugRequestController.fireEvent(event);</span>
<span class="nc" id="L122">			}</span>
		});
<span class="nc" id="L124">		SkyNet skyNet = new SkyNet(game);</span>
<span class="nc" id="L125">		skyNet.searchAndDestroy();</span>
<span class="nc" id="L126">		new Thread(() -&gt; game.startGame()).start();</span>
<span class="nc" id="L127">		musicController.start(gamePreferences.getVolume());</span>
<span class="nc" id="L128">	}</span>

	public Model getModel() {
<span class="nc" id="L131">		return game;</span>
	}

	public void performMove(final Ship ship, final List&lt;Location&gt; path) {
<span class="nc" id="L135">		logger.debug(&quot;Start move ship: &quot; + ship);</span>
<span class="nc" id="L136">		new Thread(() -&gt; ship.moveTo(Path.of(path))).start();</span>
		// moveAutomatization.addMove(new MoveAutomatization.MovePlanner(ship,
		// path));
<span class="nc" id="L139">	}</span>

	public void nextTurn() {
<span class="nc" id="L142">		logger.debug(&quot;Next Year event was triggered.&quot;);</span>
<span class="nc" id="L143">		new Thread(() -&gt; game.endTurn()).start();</span>
		// moveAutomatization.perforMoves();
<span class="nc" id="L145">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>