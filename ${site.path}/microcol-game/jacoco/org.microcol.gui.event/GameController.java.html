<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MicroCol game classes</a> &gt; <a href="index.source.html" class="el_package">org.microcol.gui.event</a> &gt; <span class="el_source">GameController.java</span></div><h1>GameController.java</h1><pre class="source lang-java linenums"><span class="nc" id="L1">package org.microcol.gui.event;</span>

import java.util.List;

import org.apache.log4j.Logger;
import org.microcol.ai.SkyNet;
import org.microcol.gui.GamePreferences;
import org.microcol.gui.Localized;
import org.microcol.gui.MusicController;
import org.microcol.model.Game;
import org.microcol.model.GameBuilder;
import org.microcol.model.Location;
import org.microcol.model.ModelListener;
import org.microcol.model.Path;
import org.microcol.model.Ship;
import org.microcol.model.event.GameFinishedEvent;
import org.microcol.model.event.GameStartedEvent;
import org.microcol.model.event.RoundStartedEvent;
import org.microcol.model.event.ShipMovedEvent;
import org.microcol.model.event.TurnStartedEvent;

import com.google.common.base.Preconditions;
import com.google.inject.Inject;

/**
 * Exchange events between model and GUI.
 */
public class GameController implements Localized {

<span class="nc" id="L30">	private Logger logger = Logger.getLogger(GameController.class);</span>

	private final NextTurnController nextTurnController;

	private final MoveUnitController moveUnitController;

	private final NewGameController newGameController;

	private final TurnStartedController turnStartedController;

	private final MusicController musicController;

	private final GamePreferences gamePreferences;

	private Game game;

	@Inject
<span class="nc" id="L47">	public GameController(final NextTurnController nextTurnController, final MoveUnitController moveUnitController,</span>
			final NewGameController newGameController, final TurnStartedController turnStartedController,
			final MusicController musicController, final GamePreferences gamePreferences) {
<span class="nc" id="L50">		this.nextTurnController = Preconditions.checkNotNull(nextTurnController);</span>
<span class="nc" id="L51">		this.moveUnitController = Preconditions.checkNotNull(moveUnitController);</span>
<span class="nc" id="L52">		this.newGameController = Preconditions.checkNotNull(newGameController);</span>
<span class="nc" id="L53">		this.turnStartedController = Preconditions.checkNotNull(turnStartedController);</span>
<span class="nc" id="L54">		this.musicController = Preconditions.checkNotNull(musicController);</span>
<span class="nc" id="L55">		this.gamePreferences = Preconditions.checkNotNull(gamePreferences);</span>
<span class="nc" id="L56">	}</span>

	/**
	 * Start new game and register listener.
	 */
	public void newGame() {
<span class="nc" id="L62">		GameBuilder builder = new GameBuilder();</span>
<span class="nc" id="L63">		game = builder.setMap(500, 500).setCalendar(1570, 1800).addPlayer(&quot;Player1&quot;, false).addShip(&quot;Player1&quot;, 5, 5, 5)</span>
<span class="nc" id="L64">				.addShip(&quot;Player1&quot;, 5, 4, 4).addPlayer(&quot;Pocitac&quot;, true).addShip(&quot;Pocitac&quot;, 5, 6, 6)</span>
<span class="nc" id="L65">				.addShip(&quot;Pocitac&quot;, 5, 7, 7).addShip(&quot;Pocitac&quot;, 5, 8, 8).build();</span>
<span class="nc" id="L66">		game.addListener(new ModelListener() {</span>

			@Override
			public void turnStarted(final TurnStartedEvent event) {
<span class="nc" id="L70">				logger.debug(&quot;Turn started for player '&quot; + event.getPlayer().getName() + &quot;'.&quot;);</span>
<span class="nc" id="L71">				turnStartedController.fireTurnStartedEvent(event);</span>
<span class="nc" id="L72">			}</span>

			@Override
			public void shipMoved(final ShipMovedEvent event) {
<span class="nc" id="L76">				logger.debug(&quot;Ship moved &quot; + event);</span>
<span class="nc" id="L77">				moveUnitController.fireUnitMovedEvent(event);</span>
<span class="nc" id="L78">			}</span>

			@Override
			public void roundStarted(final RoundStartedEvent event) {
<span class="nc" id="L82">				logger.debug(&quot;Turn started for year '&quot; + event.getCalendar().getCurrentYear() + &quot;'.&quot;);</span>
<span class="nc" id="L83">				nextTurnController.fireNextTurnEvent(event);</span>
<span class="nc" id="L84">			}</span>

			@Override
			public void gameStarted(final GameStartedEvent event) {
<span class="nc" id="L88">				logger.debug(&quot;Game started &quot; + event);</span>
<span class="nc" id="L89">				game = event.getGame();</span>
<span class="nc" id="L90">				newGameController.fireNewGameStartedEvent(event);</span>
<span class="nc" id="L91">			}</span>

			@Override
			public void gameFinished(final GameFinishedEvent event) {
<span class="nc" id="L95">				logger.debug(&quot;Game finished &quot; + event);</span>
<span class="nc" id="L96">			}</span>
		});
<span class="nc" id="L98">		SkyNet skyNet = new SkyNet(game);</span>
<span class="nc" id="L99">		skyNet.searchAndDestroy();</span>
<span class="nc" id="L100">		new Thread(() -&gt; game.start()).start();</span>
<span class="nc" id="L101">		musicController.start(gamePreferences.getVolume());</span>
<span class="nc" id="L102">	}</span>

	public Game getGame() {
<span class="nc" id="L105">		return game;</span>
	}

	public void performMove(final Ship ship, final List&lt;Location&gt; path) {
<span class="nc" id="L109">		logger.debug(&quot;Start move ship: &quot; + ship);</span>
<span class="nc" id="L110">		new Thread(() -&gt; ship.moveTo(new Path(path))).start();</span>
		// moveAutomatization.addMove(new MoveAutomatization.MovePlanner(ship,
		// path));
<span class="nc" id="L113">	}</span>

	public void nextTurn() {
<span class="nc" id="L116">		logger.debug(&quot;Next Year event was triggered.&quot;);</span>
<span class="nc" id="L117">		new Thread(() -&gt; game.endTurn()).start();</span>
		// moveAutomatization.perforMoves();
<span class="nc" id="L119">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>